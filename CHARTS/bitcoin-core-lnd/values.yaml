bitcoin-core:
  replicaCount: 1
  
  
  ############### Image ###############
  image:
    name: "ruimarinho/bitcoin-core"
    tag: latest
  
  
  ############### Service ###############
  service:
    type: "ClusterIP" 
    clusterIp: "None" # can be set to "None" for headless services
    ports: 
      - port: 8332
        targetPort: 8332
        protocol: TCP
        name: rpc-mainnet
      - port: 8333
        targetPort: 8333
        protocol: TCP
        name: p2p-mainnet
      - port: 28332          
        targetPort: 28332 
        protocol: TCP      
        name: zmq-rawblock
      - port: 28333          
        targetPort: 28333 
        protocol: TCP      
        name: zmq-rawtax   
      - port: 28334    
        targetPort: 28334 
        protocol: TCP      
        name: zmq-hashblock   
      - port: 28335          
        targetPort: 28335 
        protocol: TCP      
        name: zmq-hashtx
      - port: 29000    
        targetPort: 29000 
        protocol: TCP      
        name: zmq-all   
  

  ############### containerPorts ###############
  containerPorts:
    - containerPort: 8332
      protocol: TCP
      name: rpc-mainnet
    - containerPort: 8333
      protocol: TCP
      name: p2p-mainnet
    - containerPort: 28332
      protocol: TCP
      name: zmq-rawblock
    - containerPort: 28333
      protocol: TCP
      name: zmq-rawtax
    - containerPort: 28334
      protocol: TCP
      name: zmq-hashblock
    - containerPort: 28335
      protocol: TCP
      name: zmq-hashtx
    - containerPort: 29000
      protocol: TCP
      name: zmq-all

  ############### Node Selector ###############
  nodeSelectorEnabled: true
  nodeSelector:
    preemptible: "false"

  ############### Security Context ###############
  securityContext:
    enabled: false
    runAsUser: 100
    allowPrivilegeEscalation: false
  
  ############### command ###############
  command: 
    enabled: true
    args: [
      "-txindex=1",
      "-blockfilterindex=1",
      "-server=1",
      "-rpcbind=0.0.0.0",
      "-rpcallowip=172.0.0.0/8",
      "-rpcallowip=192.0.0.0/8",
      "-rpcallowip=127.0.0.1",
      "-rpcallowip=10.0.0.0/8",
      "-rpcport=8332",
      "-rpcauth=DUMMY_RPC_AUTH_DATA",
      "-zmqpubrawblock=tcp://0.0.0.0:28332",
      "-zmqpubrawtx=tcp://0.0.0.0:28333",
      "-zmqpubhashblock=tcp://0.0.0.0:28334",
      "-zmqpubhashtx=tcp://0.0.0.0:28335"
    ]

  ############### resources ###############
  resources:
    requests:
      memory: "1Gi"
      cpu: "0.1"
    limits:
      memory: "2Gi"
      cpu: "0.5"

  ############### termination grace period ###############
  terminationGracePeriodSeconds: 300

  ############### probes ###############
  probesEnabled: false
  livenessProbe:
    exec:
      command:
        - bitcoin-cli
        - getblockcount
    initialDelaySeconds: 300 
    periodSeconds: 60
    timeoutSeconds: 5
    failureThreshold: 5
    successThreshold: 1
  
  readinessProbe:
    exec:
      command:
        - bitcoin-cli
        - getblockcount
    initialDelaySeconds: 300
    periodSeconds: 60
    timeoutSeconds: 5
    failureThreshold: 5
    successThreshold: 1

  ############### Data Persistency ###############
  dataPersistency:
    enabled: true
    mountPath: /home/bitcoin/.bitcoin
    storageClass: bitcoin-data
    capacity: 500G
    gcePersistentDiskName: bitcoin-data-mainnet
    #providerPvConfig: a block containing the provider configuration for the persistent disks
    accessModes:
      - ReadWriteOnce 
    
  
lnd:
  replicaCount: 1
  image:
    name: "btcpayserver/lnd"
    tag: alpine
    #pullPolicy: IfNotPresent # Always
  service:
    #nameOverride: "dummy-service"
    type: "ClusterIP" 
    clusterIp: "None" # can be set to "None" for headless services
    ports: 
      - port: 9735
        targetPort: 9735
        protocol: TCP
        name: p2p-mainnet
      - port: 10009
        targetPort: 10009
        protocol: TCP
        name: rpc

  containerPorts:
    - containerPort: 9735
      protocol: TCP
      name: p2p-mainnet
    - containerPort: 10009
      protocol: TCP
      name: rpc

  nodeSelectorEnabled: true
  nodeSelector:
    preemptible: "false"

  securityContext:
    enabled: false
    runAsUser: 100
    allowPrivilegeEscalation: false

  command: 
    enabled: true
    args: [
      "--bitcoin.active",
      "--bitcoin.mainnet",
      "--debuglevel=debug",
      "--bitcoin.node=bitcoind",
      "--bitcoind.rpcuser=DUMMY_USER",
      "--bitcoind.rpcpass=DUMMY_RPC_PASS",
      "--bitcoind.zmqpubrawblock=tcp://bitcoin-core:28332",
      "--bitcoind.zmqpubrawtx=tcp://bitcoin-core:28333",
      "--externalip=bitcoin-core:8332"
    ]

  resources:
    requests:
      memory: "1Gi"
      cpu: "0.1"
    limits:
      memory: "2Gi"
      cpu: "0.6"

  terminationGracePeriodSeconds: 300
  probesEnabled: false
  livenessProbe:
    exec:
      command:
        - bitcoin-cli
        - getblockcount
    # use generous initial delay. if the node was NOT propperly shutdown before, 
    # the resync (rolling forward) will last for several hours before it is complete...
    # during this time, all CLI commands will fail and kubernetes will kill the pod 
    # and cause it to crashloop. 300 seconds seems to be enough in normal conditions
    initialDelaySeconds: 300 
    periodSeconds: 60
    timeoutSeconds: 5
    failureThreshold: 5
    successThreshold: 1

  readinessProbe:
    exec:
      command:
        - bitcoin-cli
        - getblockcount
    # use generous initial delay. if the node was NOT propperly shutdown before, 
    # the resync (rolling forward) will last for several hours before it is complete...
    # during this time, all CLI commands will fail and kubernetes will kill the pod 
    # and cause it to crashloop. 300 seconds seems to be enough in normal conditions
    initialDelaySeconds: 300
    periodSeconds: 60
    timeoutSeconds: 5
    failureThreshold: 5
    successThreshold: 1


  dataPersistency:
    enabled: true
    mountPath: /home/root/.lnd
    storageClass: lnd-data
    capacity: 5G
    gcePersistentDiskName: lnd-data-mainnet
    accessModes:
      - ReadWriteOnce 
